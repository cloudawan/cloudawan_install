- name: Install linux bridge
  apt: name=keepalived update_cache=yes
  become: true
  
- name: Install linux bridge
  apt: name=haproxy update_cache=yes
  become: true
  
- name: Modify /etc/sysctl.conf
  lineinfile: dest=/etc/sysctl.conf line="net.ipv4.ip_nonlocal_bind=1"
  become: true
  
- name: Reset sysctl
  command: /sbin/sysctl -p
  
- name: Create keepalived configuration
  template: src=roles/master_node/templates/etc/keepalived/keepalived.conf.j2 dest=/etc/keepalived/keepalived.conf backup=no force=yes
  become: true
  
- name: Create HAproxy configuration
  template: src=roles/master_node/templates/etc/haproxy/haproxy.cfg.j2 dest=/etc/haproxy/haproxy.cfg backup=no force=yes
  become: true
  
- name: Modify /etc/default/haproxy
  lineinfile: dest=/etc/default/haproxy line="ENABLED=1"
  become: true
  
- name: Run keepalived 
  service: name=keepalived state=restarted
  become: true
  
- name: Run haproxy
  service: name=haproxy state=restarted
  become: true