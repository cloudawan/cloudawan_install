# hosts

- name: Create the hosts file for all machines
  template: src=roles/master_node/templates/hosts.j2 dest=/etc/hosts backup=no force=yes
  become: true

# linux bridge
  
- name: Install linux bridge
  apt: name=bridge-utils
  become: true

# docker
  
- name: Add docker repository
  apt_repository: repo='deb https://apt.dockerproject.org/repo ubuntu-trusty main' filename=docker
  become: true
  
- name: Add apt-get key
  apt_key: keyserver=hkp://p80.pool.sks-keyservers.net:80 id=58118E89F3A912897C070ADBF76221572C52609D
  become: true

- name: Run apt-get update and install docker
  apt: name=docker-engine=1.10.3-0~trusty update_cache=yes
  become: true

# ntp
  
- name: Run apt-get to install ntp
  apt: name=ntp
  become: true
  
- name: Run ntp
  service: name=ntp state=started
  become: true

# pip

- name: Run apt-get to install ntp
  apt: name=python-pip
  become: true

- name: Install httplib2
  pip: name=httplib2
  become: yes
  
# program directory
  
- name: Creates directory to run programs
  file: path=/opt/bin state=directory
  become: true

# etcd
  
- name: Copy /opt/bin/etcd
  copy: src=roles/master_node/files/opt/bin/etcd dest=/opt/bin/etcd mode=0755
  become: true
  
- name: Copy /opt/bin/etcdctl
  copy: src=roles/master_node/files/opt/bin/etcdctl dest=/opt/bin/etcdctl mode=0755
  become: true
  
- name: Copy /etc/init.d/etcd
  copy: src=roles/master_node/files/etc/init.d/etcd dest=/etc/init.d/etcd mode=0755
  become: true

- name: Copy /etc/init/etcd.conf
  copy: src=roles/master_node/files/etc/init/etcd.conf dest=/etc/init/etcd.conf mode=0755
  become: true

- name: Create the /etc/default/etcd file for all machines
  template: src=roles/master_node/templates/etc/default/etcd.j2 dest=/etc/default/etcd backup=no force=yes
  become: true

- name: Run etcd
  service: name=etcd state=started
  become: true

